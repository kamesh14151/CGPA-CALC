<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Engineering GPA & CGPA Calculator | AJ STUDIOS</title>
    <!-- Custom Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ§®</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6a11cb; --secondary: #2575fc; --success: #00b09b; --danger: #ff416c;
            --warning: #ffb347; --info: #3498db; --light: #f8f9fa; --dark: #100721;
            --text-primary: #ffffff; --text-secondary: rgba(255, 255, 255, 0.8);
            --card-bg: rgba(255, 255, 255, 0.08); --border-color: rgba(255, 255, 255, 0.15);
            --shadow-color: rgba(0, 0, 0, 0.2);
            --cse-color: #4ECDC4; --it-color: #45B7D1; --ece-color: #A18CD1; --eee-color: #FFA07A; --mech-color: #FF6B6B;
            --civil-color: #A1D1A1; --bme-color: #FFB347; --ft-color: #FF85A2; --mct-color: #8A2BE2; --aiml-color: #00CED1;
            --csd-color: #9370DB; --ads-color: #20B2AA; --efe-color: #6495ED; --exe-color: #4682B4;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        @keyframes background-pan { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes stagger-in { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* --- NEW: Continuous Shimmer Animation --- */
        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        body {
            font-family: "Poppins", sans-serif; background: linear-gradient(135deg, var(--dark), #1a1a2e);
            color: var(--text-primary); min-height: 100vh; line-height: 1.6; background-attachment: fixed;
        }
        .aurora-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(ellipse at 10% 10%, var(--primary) 0%, rgba(106, 17, 203, 0) 40%), radial-gradient(ellipse at 90% 85%, var(--secondary) 0%, rgba(37, 117, 252, 0) 35%); animation: background-pan 30s linear infinite; opacity: 0.3; }
        .container { max-width: 1400px; margin: 30px auto; background: rgba(16, 7, 33, 0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); padding: 30px; border-radius: 20px; box-shadow: 0 15px 35px var(--shadow-color); border: 1px solid var(--border-color); }
        .header { text-align: center; margin-bottom: 20px; }
        .logo { width: 60px; height: 60px; background: linear-gradient(45deg, var(--primary), var(--secondary)); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px var(--shadow-color); margin-bottom: 10px; }
        .logo i { font-size: 1.8rem; color: white; }
        
        .animated-brand {
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: 2px;
            margin-bottom: 10px;
            background: linear-gradient(120deg, var(--primary) 20%, var(--secondary) 40%, var(--light) 50%, var(--secondary) 60%, var(--primary) 80%);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: shimmer 4s linear infinite;
        }
        
        h1 { font-size: 2.2rem; background: linear-gradient(90deg, #fff, #c9d6ff); -webkit-background-clip: text; background-clip: text; color: transparent; text-shadow: 0 3px 6px var(--shadow-color); }
        
        .summary-dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .summary-card { background: var(--card-bg); border-radius: 15px; padding: 20px; text-align: center; border-left: 5px solid var(--info); }
        .summary-card .icon { font-size: 1.8rem; margin-bottom: 10px; }
        .summary-card .value { font-size: 2rem; font-weight: 700; }
        .summary-card .label { font-size: 0.9rem; color: var(--text-secondary); }
        #summary-cgpa { border-color: var(--success); } #summary-arrears { border-color: var(--danger); }
        .mini-chart-container { min-height: 150px; position: relative; }

        .dashboard-layout { display: grid; grid-template-columns: 350px 1fr; gap: 30px; }
        .left-panel { display: flex; flex-direction: column; gap: 20px; }
        
        .form-group { background: var(--card-bg); padding: 20px; border-radius: 15px; }
        .arrears-section { background: rgba(255, 65, 108, 0.1); padding: 20px; border-radius: 15px; border: 1px solid var(--danger); }
        .arrears-section h3 { font-size: 1.2rem; margin-bottom: 10px; color: var(--danger); }
        .arrears-list { list-style: none; padding-left: 0; }
        .arrears-list li { background: rgba(255,255,255,0.05); padding: 8px 12px; border-radius: 8px; margin-bottom: 5px; font-size: 0.9rem; }

        .branch-selection { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .branch-card { cursor: pointer; border: 2px solid transparent; background: rgba(255,255,255,0.05); text-align: center; padding: 15px 10px; border-radius: 10px; transition: all 0.3s ease; }
        .branch-card:hover { background: rgba(255,255,255,0.1); }
        .branch-card.selected { border-color: var(--secondary); background: rgba(37, 117, 252, 0.2); }
        .branch-card i { font-size: 1.5rem; }
        .branch-card .branch-name { font-size: 0.85rem; margin-top: 8px; font-weight: 500; }
        
        .subject-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .subject-card { background: var(--card-bg); border-radius: 15px; padding: 15px; transition: all 0.3s ease; animation: stagger-in 0.5s ease both; }
        
        .empty-state { text-align: center; padding: 40px; background: var(--card-bg); border-radius: 15px; margin-top: 20px; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .empty-state i { font-size: 3rem; color: var(--secondary); margin-bottom: 15px; }

        #gpaResult { background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 15px; padding: 25px; text-align: center; }
        
        select, input { width: 100%; padding: 12px 15px; border-radius: 12px; border: 1px solid transparent; font-size: 16px; background: rgba(255, 255, 255, 0.9); color: #2c3e50; transition: all 0.3s ease; }
        select:focus, input:focus { outline: none; box-shadow: 0 0 0 3px var(--secondary); }
        
        .footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border-color); font-size: 0.9rem; color: var(--text-secondary); }
        .footer p { margin: 5px 0; }
        .footer .brand-main { font-weight: 600; color: var(--text-primary); }
        
        @media (max-width: 1024px) {
            .dashboard-layout { grid-template-columns: 1fr; }
            .header, .container { padding: 15px; }
            h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="aurora-background"></div>
    <div id="themeToggle" title="Toggle Dark Mode" style="position: fixed; top: 20px; right: 20px; background: rgba(255,255,255,0.1); border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 100;">
        <i class="fas fa-moon"></i>
    </div>

    <div class="container">
        <header class="header">
            <div class="logo"><i class="fas fa-calculator"></i></div>
            <p class="animated-brand">AJ STUDIOS</p>
            <h1>GPA & CGPA Calculator</h1>
        </header>

        <section class="summary-dashboard">
            <div class="summary-card" id="summary-cgpa">
                <div class="icon"><i class="fas fa-chart-line"></i></div>
                <div class="value" id="summaryCgpaValue">0.00</div>
                <div class="label">Overall CGPA</div>
            </div>
            <div class="summary-card" id="summary-credits">
                <div class="icon"><i class="fas fa-star"></i></div>
                <div class="value" id="summaryCreditsValue">0</div>
                <div class="label">Total Credits</div>
            </div>
            <div class="summary-card" id="summary-arrears">
                <div class="icon"><i class="fas fa-exclamation-triangle"></i></div>
                <div class="value" id="summaryArrearsValue">0</div>
                <div class="label">Arrears</div>
            </div>
            <div class="summary-card">
                <div class="label">Grade Distribution</div>
                <div class="mini-chart-container">
                    <canvas id="gradeDistSummaryChart"></canvas>
                </div>
            </div>
        </section>

        <main class="dashboard-layout">
            <aside class="left-panel">
                <div class="form-group">
                    <label for="branchSelection"><i class="fas fa-university"></i> Branch</label>
                    <div class="branch-selection" id="branchSelection"></div>
                </div>
                <div class="form-group" id="semesterGroup" style="display: none;">
                    <label for="semester"><i class="fas fa-graduation-cap"></i> Semester</label>
                    <select id="semester"></select>
                </div>
                <div id="arrearsSection" class="arrears-section" style="display: none;">
                    <h3><i class="fas fa-flag"></i> Arrear Subjects</h3>
                    <ul id="arrearsList" class="arrears-list"></ul>
                </div>
            </aside>
            <section class="right-panel">
                <div id="subjectForm">
                    <div class="empty-state">
                        <i class="fas fa-hand-pointer"></i>
                        <p>Please select your branch to get started.</p>
                    </div>
                </div>
                <div id="gpaResult" style="display: none; margin-top: 20px;"></div>
            </section>
        </main>
        
        <footer class="footer">
            <p><span class="brand-main">AJ STUDIOS</span></p>
            <p>Powered by AJ COMPANY</p>
        </footer>
    </div>
    
    <script>
    const academicData = {
        branches: {"CSE":{"name":"Computer Science","color":"var(--cse-color)","icon":"fas fa-laptop-code","semesters":{"1":[{"code":"U23ENG101A","name":"Communication Skills in English","credits":3},{"code":"U23MAT102A","name":"Linear Algebra and Calculus With MATLAB","credits":4},{"code":"U23PHY103B","name":"Engineering Physics","credits":3},{"code":"U23PPR105","name":"Problem Solving using Python Programming","credits":3},{"code":"U23BEE106A","name":"Basic Electrical and Electronics Engineering","credits":3},{"code":"U23TAM101","name":"Heritage of Tamils","credits":1},{"code":"U23PHL110","name":"Engineering Physics Lab","credits":1},{"code":"U23BEEL113","name":"Basic Electrical and Electronics Engineering Lab","credits":1},{"code":"U23PPL112","name":"Python Programming Lab","credits":1}],"2":[{"code":"U23ENG201A","name":"Technical English","credits":2},{"code":"U23MAT202B","name":"Discrete Mathematics","credits":4},{"code":"U23CHE204B","name":"Chemistry For Computer Science","credits":3},{"code":"U23CPR205B","name":"Programming In C","credits":3},{"code":"U23EGR207","name":"Engineering Graphics","credits":3},{"code":"U23EC203","name":"Digital Principles And System Design","credits":3},{"code":"U23CHL211","name":"Chemistry Lab","credits":1},{"code":"U23CPL212","name":"C programming Lab","credits":1},{"code":"U23TAM201","name":"Tamils And Technology","credits":1}],"3":[{"code":"U23MAT301D","name":"Probability and Statistics","credits":4},{"code":"U23CS301","name":"Data Structures","credits":3},{"code":"U23CS302","name":"Computer Architecture","credits":3},{"code":"U23CS303","name":"Object Oriented Programming","credits":3},{"code":"U23CS304","name":"Operating Systems","credits":3},{"code":"U23CS305","name":"Computer Information and Ethics","credits":3},{"code":"U23CS306","name":"Data Structures Lab","credits":1},{"code":"U23CS307","name":"Object Oriented Programming Lab","credits":1},{"code":"U23GE301","name":"Soft Skills and Aptitude-I","credits":1},{"code":"Noc24-mg72","name":"NPTEL:design Thinking-A Primer","credits":1}],"4":[{"code":"U23MAT401B","name":"Numerical Methods","credits":4},{"code":"U23CS401","name":"Design And Analysis of Algorithms","credits":3},{"code":"U23CS402","name":"Software Engineering","credits":3},{"code":"U23CS403","name":"DataBase Management Systems","credits":3},{"code":"U23CS404","name":"Embedded System Design ","credits":3},{"code":"U23CS405","name":"Software Development Lab","credits":1},{"code":"U23CS403","name":"Database Management Systems Lab","credits":1}],"5":[{"code":"U23CS504","name":"Machine Learning","credits":3},{"code":"U23CS501","name":"Computer Networks","credits":3},{"code":"U23CS502","name":"Artificial Intelligence","credits":3},{"code":"U23CS503","name":"Theory of Computation","credits":3},{"code":"noc25-cs135","name":"Elective NPTEL","credits":3},{"code":" U23CS947 / U23CS903","name":"Professional Elective ","credits":3},{"code":"U23CS505","name":"Computer Networks Laboratory","credits":2},{"code":"U23CS506","name":"Artificial Intelligence and Machine Learning Laboratory","credits":1},{"code":"U23GE501","name":"Soft Skills and Aptitude -III","credits":1}],"6":[],"7":[],"8":[]}},
            "IT":{"name":"Info. Technology","color":"var(--it-color)","icon":"fas fa-network-wired","semesters":{"1":[{"code":"U23IT101","name":"Programming Fundamentals","credits":4},{"code":"U23IT102","name":"Discrete Mathematics","credits":4},{"code":"U23IT103","name":"Digital Systems","credits":3},{"code":"U23IT104","name":"Computer Organization","credits":3},{"code":"U23IT105","name":"Communication Skills","credits":2},{"code":"U23IT106","name":"Programming Lab","credits":1},{"code":"U23IT107","name":"Digital Systems Lab","credits":1}],"2":[{"code":"U23IT201","name":"Data Structures","credits":4},{"code":"U23IT202","name":"Database Systems","credits":4},{"code":"U23IT203","name":"Operating Systems","credits":3},{"code":"U23IT204","name":"Computer Networks","credits":3},{"code":"U23IT205","name":"Web Technologies","credits":3},{"code":"U23IT206","name":"Data Structures Lab","credits":1},{"code":"U23IT207","name":"Web Technologies Lab","credits":1}],"3":[],"4":[],"5":[],"6":[],"7":[],"8":[]}},
            "ECE":{"name":"Electronics & Comm","color":"var(--ece-color)","icon":"fas fa-satellite-dish","semesters":{"1":[{"code":"U23EC101","name":"Basic Electronics","credits":4},{"code":"U23EC102","name":"Circuit Theory","credits":4},{"code":"U23EC103","name":"Engineering Mathematics","credits":4},{"code":"U23EC104","name":"Programming in C","credits":3},{"code":"U23EC105","name":"Communication Skills","credits":2},{"code":"U23EC106","name":"Electronics Lab","credits":1},{"code":"U23EC107","name":"Programming Lab","credits":1}],"2":[{"code":"U23EC201","name":"Analog Electronics","credits":4},{"code":"U23EC202","name":"Digital Electronics","credits":4},{"code":"U23EC203","name":"Signals and Systems","credits":4},{"code":"U23EC204","name":"Electromagnetic Theory","credits":3},{"code":"U23EC205","name":"Data Structures","credits":3},{"code":"U23EC206","name":"Analog Electronics Lab","credits":1},{"code":"U23EC207","name":"Digital Electronics Lab","credits":1}],"3":[],"4":[],"5":[],"6":[],"7":[],"8":[]}},
            "EEE":{"name":"Electrical & Electronics","color":"var(--eee-color)","icon":"fas fa-bolt","semesters":{"1":[{"code":"U23EE101","name":"Basic Electrical Engineering","credits":4},{"code":"U23EE102","name":"Engineering Mathematics","credits":4},{"code":"U23EE103","name":"Electronics Engineering","credits":3},{"code":"U23EE104","name":"Programming in C","credits":3},{"code":"U23EE105","name":"Communication Skills","credits":2},{"code":"U23EE106","name":"Electrical Lab","credits":1},{"code":"U23EE107","name":"Programming Lab","credits":1}],"2":[{"code":"U23EE201","name":"Circuit Theory","credits":4},{"code":"U23EE202","name":"Electromagnetic Theory","credits":4},{"code":"U23EE203","name":"Digital Electronics","credits":4},{"code":"U23EE204","name":"Electrical Machines","credits":3},{"code":"U23EE205","name":"Data Structures","credits":3},{"code":"U23EE206","name":"Circuit Theory Lab","credits":1},{"code":"U23EE207","name":"Digital Electronics Lab","credits":1}],"3":[],"4":[],"5":[],"6":[],"7":[],"8":[]}},
            "MECH":{"name":"Mechanical","color":"var(--mech-color)","icon":"fas fa-cogs","semesters":{"1":[{"code":"U23ME101","name":"Engineering Mechanics","credits":4},{"code":"U23ME102","name":"Engineering Graphics","credits":4},{"code":"U23ME103","name":"Engineering Mathematics","credits":4},{"code":"U23ME104","name":"Basic Electrical Engineering","credits":3},{"code":"U23ME105","name":"Communication Skills","credits":2},{"code":"U23ME106","name":"Workshop Practice","credits":1},{"code":"U23ME107","name":"Engineering Graphics Lab","credits":1}],"2":[{"code":"U23ME201","name":"Thermodynamics","credits":4},{"code":"U23ME202","name":"Mechanics of Materials","credits":4},{"code":"U23ME203","name":"Manufacturing Technology","credits":4},{"code":"U23ME204","name":"Fluid Mechanics","credits":3},{"code":"U23ME205","name":"Computer Programming","credits":3},{"code":"U23ME206","name":"Thermodynamics Lab","credits":1},{"code":"U23ME207","name":"Manufacturing Technology Lab","credits":1}],"3":[],"4":[],"5":[],"6":[],"7":[],"8":[]}},
            "AIML":{"name":"AI & Machine Learning","color":"var(--aiml-color)","icon":"fas fa-brain","semesters":{"1":[{"code":"U23EG107","name":"Engineering Graphics","credits":3},{"code":"U23ENG101A","name":"Communication Skills in English","credits":3},{"code":"U23MAT102A","name":"Linear Algebra and Calculus with MATLAB","credits":4},{"code":"U23PPR105","name":"Problem Solving using Python Programming","credits":3},{"code":"U23PHY103E","name":"Engineering Physics","credits":3},{"code":"U23PHL110","name":"Engineering Physics Laboratory","credits":1},{"code":"U23PPL112","name":"Python Programming Laboratory","credits":1},{"code":"U23TAM101","name":"Heritage of Tamils","credits":1}],"2":[{"code":"U23ENG201A","name":"Technical English","credits":2},{"code":"U23MAT202D","name":"Discrete Mathematics","credits":4},{"code":"U23BEEE206B","name":"Basics of Electrical and Electronics Engineering","credits":3},{"code":"U23CPR205","name":"Programming in C","credits":3},{"code":"U23CHE204C","name":"Applied Chemistry","credits":2},{"code":"U23EC203","name":"Digital Principles and System Design","credits":3},{"code":"U23CPL212","name":"C Programming Laboratory","credits":1},{"code":"U23CHL211","name":"Chemistry Laboratory","credits":1},{"code":"U23BEEL213B","name":"BEEE Laboratory","credits":1},{"code":"U23TAM201","name":"Tamils and Technology","credits":1}],"3":[{"code":"U23MAT301E","name":"Applied Probability and Statistics-I","credits":4},{"code":"U23CS301","name":"Data Structures","credits":3},{"code":"U23CS302","name":"Computer Architecture","credits":3},{"code":"U23CS303","name":"Object Oriented Programming Using Java","credits":3},{"code":"U23AML301","name":"Data Visualization","credits":3},{"code":"noc25-mg106","name":"NPTEL: Design Thinking - A Primer","credits":1},{"code":"U23CS306","name":"Data Structures Laboratory","credits":1},{"code":"U23CS307","name":"Object Oriented Programming Using Java Laboratory","credits":1},{"code":"U23AML302","name":"Data Visualization Laboratory","credits":1},{"code":"U23GE301","name":"Soft Skills and Aptitude-I","credits":1}],"4":[{"code":"U23MAT401A","name":"Applied Probability and Statistics-II","credits":4},{"code":"U23CS403","name":"Database Management Systems","credits":3},{"code":"U23CS401","name":"Design and Analysis of Algorithms","credits":3},{"code":"U23AML401","name":"Artificial Intelligence","credits":3},{"code":"U23CSD402","name":"Operating Systems","credits":3},{"code":"U23AML402","name":"Artificial Intelligence Lab","credits":1},{"code":"U23CS405","name":"Database Management Systems Lab","credits":1},{"code":"U23GE401","name":"Soft Skills and Aptitude-II","credits":1}],"5":[{"code":"U23CS504","name":"Machine Learning","credits":3},{"code":"U23CS501","name":"Computer Networks","credits":3},{"code":"U23CSD502","name":"Software Engineering","credits":3},{"code":"U23CS503","name":"Theory of Computation","credits":3},{"code":"noc25-cs135","name":"Elective NPTEL","credits":3},{"code":"U19CS903","name":"Professional Elective - Agile Methodologies","credits":3},{"code":"U23AML501","name":"Machine Learning Laboratory","credits":2},{"code":"U23CSD504","name":"Software Development Laboratory","credits":1},{"code":"U23GE501","name":"Soft Skills and Aptitude -III","credits":1}],"6":[{"code":"U23CS601","name":"Computer Vision","credits":3},{"code":"U23CS602","name":"Reinforcement Learning","credits":3},{"code":"U23CS603","name":"Robotics","credits":3},{"code":"U23CS604","name":"Cyber Security","credits":3},{"code":"U23CS605","name":"Blockchain Technology","credits":3},{"code":"U23CS606","name":"Elective III","credits":3},{"code":"U23CS607","name":"Project Work II","credits":3}],"7":[{"code":"U23CS701","name":"Advanced Machine Learning","credits":3},{"code":"U23CS702","name":"AI Ethics and Governance","credits":3},{"code":"U23CS703","name":"Elective IV","credits":3},{"code":"U23CS704","name":"Project Work III","credits":3}],"8":[{"code":"U23CS801","name":"Industry Internship","credits":6},{"code":"U23CS802","name":"Project Work IV","credits":6}]}},
            "CIVIL":{"name":"Civil Engineering","color":"var(--civil-color)","icon":"fas fa-building","semesters":{"1":[{"code":"U23CE101","name":"Engineering Mechanics","credits":4},{"code":"U23CE102","name":"Engineering Graphics","credits":4},{"code":"U23CE103","name":"Engineering Mathematics","credits":4},{"code":"U23CE104","name":"Basic Civil Engineering","credits":3},{"code":"U23CE105","name":"Communication Skills","credits":2},{"code":"U23CE106","name":"Surveying","credits":1},{"code":"U23CE107","name":"Engineering Graphics Lab","credits":1}],"2":[{"code":"U23CE201","name":"Building Materials","credits":4},{"code":"U23CE202","name":"Structural Analysis","credits":4},{"code":"U23CE203","name":"Fluid Mechanics","credits":4},{"code":"U23CE204","name":"Surveying","credits":3},{"code":"U23CE205","name":"Computer Programming","credits":3},{"code":"U23CE206","name":"Building Materials Lab","credits":1},{"code":"U23CE207","name":"Surveying Lab","credits":1}]}},
            "BME":{"name":"Bio Medical","color":"var(--bme-color)","icon":"fas fa-heartbeat","semesters":{"1":[{"code":"U23BM101","name":"Human Anatomy","credits":4},{"code":"U23BM102","name":"Engineering Mathematics","credits":4},{"code":"U23BM103","name":"Basic Electronics","credits":3},{"code":"U23BM104","name":"Programming in C","credits":3},{"code":"U23BM105","name":"Communication Skills","credits":2},{"code":"U23BM106","name":"Human Anatomy Lab","credits":1},{"code":"U23BM107","name":"Programming Lab","credits":1}],"2":[{"code":"U23BM201","name":"Human Physiology","credits":4},{"code":"U23BM202","name":"Biochemistry","credits":4},{"code":"U23BM203","name":"Medical Electronics","credits":4},{"code":"U23BM204","name":"Biomechanics","credits":3},{"code":"U23BM205","name":"Data Structures","credits":3},{"code":"U23BM206","name":"Human Physiology Lab","credits":1},{"code":"U23BM207","name":"Medical Electronics Lab","credits":1}]}},
            "FT":{"name":"Fashion Technology","color":"var(--ft-color)","icon":"fas fa-tshirt","semesters":{"1":[{"code":"U23FT101","name":"Fiber Science","credits":4},{"code":"U23FT102","name":"Textile Chemistry","credits":4},{"code":"U23FT103","name":"Fashion Illustration","credits":3},{"code":"U23FT104","name":"Pattern Making","credits":3},{"code":"U23FT105","name":"Communication Skills","credits":2},{"code":"U23FT106","name":"Textile Chemistry Lab","credits":1},{"code":"U23FT107","name":"Pattern Making Lab","credits":1}],"2":[{"code":"U23FT201","name":"Textile Processing","credits":4},{"code":"U23FT202","name":"Apparel Manufacturing","credits":4},{"code":"U23FT203","name":"Fashion Design","credits":4},{"code":"U23FT204","name":"Garment Construction","credits":3},{"code":"U23FT205","name":"Computer Applications","credits":3},{"code":"U23FT206","name":"Apparel Manufacturing Lab","credits":1},{"code":"U23FT207","name":"Garment Construction Lab","credits":1}]}},
            "MCT":{"name":"Mechatronics","color":"var(--mct-color)","icon":"fas fa-robot","semesters":{"1":[{"code":"U23MT101","name":"Engineering Mechanics","credits":4},{"code":"U23MT102","name":"Engineering Graphics","credits":4},{"code":"U23MT103","name":"Engineering Mathematics","credits":4},{"code":"U23MT104","name":"Basic Electronics","credits":3},{"code":"U23MT105","name":"Communication Skills","credits":2},{"code":"U23MT106","name":"Workshop Practice","credits":1},{"code":"U23MT107","name":"Engineering Graphics Lab","credits":1}],"2":[{"code":"U23MT201","name":"Thermodynamics","credits":4},{"code":"U23MT202","name":"Mechanics of Materials","credits":4},{"code":"U23MT203","name":"Digital Electronics","credits":4},{"code":"U23MT204","name":"Fluid Mechanics","credits":3},{"code":"U23MT205","name":"Computer Programming","credits":3},{"code":"U23MT206","name":"Thermodynamics Lab","credits":1},{"code":"U23MT207","name":"Digital Electronics Lab","credits":1}]}},
            "CSD":{"name":"CS & Design","color":"var(--csd-color)","icon":"fas fa-paint-brush","semesters":{"1":[{"code":"U23CD101","name":"Design Fundamentals","credits":4},{"code":"U23CD102","name":"Programming Basics","credits":4},{"code":"U23CD103","name":"Visual Communication","credits":3},{"code":"U23CD104","name":"Mathematics for Design","credits":3},{"code":"U23CD105","name":"Communication Skills","credits":2},{"code":"U23CD106","name":"Design Studio","credits":1},{"code":"U23CD107","name":"Programming Lab","credits":1}],"2":[{"code":"U23CD201","name":"User Interface Design","credits":4},{"code":"U23CD202","name":"Data Structures","credits":4},{"code":"U23CD203","name":"Web Design","credits":4},{"code":"U23CD204","name":"Digital Illustration","credits":3},{"code":"U23CD205","name":"Human-Computer Interaction","credits":3},{"code":"U23CD206","name":"UI Design Lab","credits":1},{"code":"U23CD207","name":"Web Design Lab","credits":1}]}},
            "ADS":{"name":"AI & Data Science","color":"var(--ads-color)","icon":"fas fa-database","semesters":{"1":[{"code":"U23DS101","name":"Programming Fundamentals","credits":4},{"code":"U23DS102","name":"Linear Algebra","credits":4},{"code":"U23DS103","name":"Statistics Basics","credits":3},{"code":"U23DS104","name":"Computational Thinking","credits":3},{"code":"U23DS105","name":"Communication Skills","credits":2},{"code":"U23DS106","name":"Programming Lab","credits":1},{"code":"U23DS107","name":"Statistics Lab","credits":1}],"2":[{"code":"U23DS201","name":"Data Structures","credits":4},{"code":"U23DS202","name":"Probability and Statistics","credits":4},{"code":"U23DS203","name":"Database Systems","credits":4},{"code":"U23DS204","name":"Data Visualization","credits":3},{"code":"U23DS205","name":"Python Programming","credits":3},{"code":"U23DS206","name":"Data Structures Lab","credits":1},{"code":"U23DS207","name":"Database Lab","credits":1}]}},
            "EFE":{"name":"Electrical & Computer","color":"var(--efe-color)","icon":"fas fa-microchip","semesters":{"1":[{"code":"U23EF101","name":"Circuit Theory","credits":4},{"code":"U23EF102","name":"Programming Fundamentals","credits":4},{"code":"U23EF103","name":"Digital Electronics","credits":3},{"code":"U23EF104","name":"Engineering Mathematics","credits":3},{"code":"U23EF105","name":"Communication Skills","credits":2},{"code":"U23EF106","name":"Circuit Theory Lab","credits":1},{"code":"U23EF107","name":"Programming Lab","credits":1}],"2":[{"code":"U23EF201","name":"Signals and Systems","credits":4},{"code":"U23EF202","name":"Data Structures","credits":4},{"code":"U23EF203","name":"Analog Electronics","credits":4},{"code":"U23EF204","name":"Electromagnetic Theory","credits":3},{"code":"U23EF205","name":"Computer Organization","credits":3},{"code":"U23EF206","name":"Analog Electronics Lab","credits":1},{"code":"U23EF207","name":"Data Structures Lab","credits":1}]}},
            "EXE":{"name":"Electronics & Computer","color":"var(--exe-color)","icon":"fas fa-desktop","semesters":{"1":[{"code":"U23EX101","name":"Basic Electronics","credits":4},{"code":"U23EX102","name":"Programming Fundamentals","credits":4},{"code":"U23EX103","name":"Digital Logic Design","credits":3},{"code":"U23EX104","name":"Engineering Mathematics","credits":3},{"code":"U23EX105","name":"Communication Skills","credits":2},{"code":"U23EX106","name":"Electronics Lab","credits":1},{"code":"U23EX107","name":"Programming Lab","credits":1}],"2":[{"code":"U23EX201","name":"Data Structures","credits":4},{"code":"U23EX202","name":"Analog Electronics","credits":4},{"code":"U23EX203","name":"Computer Organization","credits":4},{"code":"U23EX204","name":"Signals and Systems","credits":3},{"code":"U23EX205","name":"Database Systems","credits":3},{"code":"U23EX206","name":"Analog Electronics Lab","credits":1},{"code":"U23EX207","name":"Data Structures Lab","credits":1}]}}}
    };

    const gradePoints = { "O": 10, "A+": 9, "A": 8, "B+": 7, "B": 6, "C": 5, "U": 0 };
    let currentBranch = "", currentGrades = {}, gpaPerSem = {}, gradeDistSummaryChart;
    const debounce = (func, delay) => { let timeout; return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), delay); }; };
    const debouncedFullUpdate = debounce(() => updateAllDisplays(), 400);

    document.addEventListener('DOMContentLoaded', () => {
        const semesterSelect = document.getElementById('semester');
        const subjectForm = document.getElementById('subjectForm');

        loadState();
        loadBranches();
        initCharts();

        if (currentBranch && academicData.branches[currentBranch]) {
            selectBranch(currentBranch, true);
            const lastSem = localStorage.getItem("lastSemester");
            if (lastSem) { semesterSelect.value = lastSem; loadSubjects(); }
        } else {
            subjectForm.innerHTML = `<div class="empty-state"><i class="fas fa-hand-pointer"></i><p>Please select your branch to get started.</p></div>`;
        }
        
        semesterSelect.addEventListener('change', loadSubjects);
        subjectForm.addEventListener('change', handleGradeChange);
        document.getElementById('themeToggle').addEventListener('click', toggleDarkMode);
    });

    function loadState() {
        currentGrades = JSON.parse(localStorage.getItem("currentGrades")) || {};
        gpaPerSem = JSON.parse(localStorage.getItem("gpaPerSem")) || {};
        currentBranch = localStorage.getItem("lastBranch") || "";
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
            document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
        }
        updateAllDisplays();
    }

    // --- Core UI Rendering ---
    function loadBranches() {
        const fragment = document.createDocumentFragment();
        Object.keys(academicData.branches).forEach((code, index) => {
            const branch = academicData.branches[code];
            const card = document.createElement('div');
            card.className = 'branch-card stagger-in';
            card.style.animationDelay = `${index * 30}ms`;
            card.dataset.branchCode = code;
            card.innerHTML = `<div class="branch-icon" style="color: ${branch.color};"><i class="${branch.icon}"></i></div>
                              <div class="branch-name">${branch.name}</div>`;
            fragment.appendChild(card);
        });
        const branchSelection = document.getElementById("branchSelection");
        branchSelection.innerHTML = '';
        branchSelection.appendChild(fragment);
        branchSelection.addEventListener('click', (e) => {
            const card = e.target.closest('.branch-card');
            if(card) selectBranch(card.dataset.branchCode);
        });
    }

    function selectBranch(branchCode, isRestoring = false) {
        if (currentBranch === branchCode && !isRestoring) return;
        currentBranch = branchCode;
        localStorage.setItem("lastBranch", branchCode);

        document.querySelectorAll(".branch-card").forEach(c => c.classList.remove("selected"));
        document.querySelector(`.branch-card[data-branch-code="${branchCode}"]`).classList.add("selected");

        const semSelect = document.getElementById("semester");
        const availableSems = Object.keys(academicData.branches[branchCode].semesters).filter(sem => academicData.branches[branchCode].semesters[sem]?.length > 0);
        semSelect.innerHTML = '<option value="">-- Select Semester --</option>' + availableSems.map(sem => `<option value="${sem}">Semester ${sem}</option>`).join('');
        
        document.getElementById("semesterGroup").style.display = "block";

        if (!isRestoring) {
            semSelect.value = "";
            loadSubjects();
        }
        updateAllDisplays();
    }
    
    function loadSubjects() {
        const sem = document.getElementById("semester").value;
        const form = document.getElementById("subjectForm");
        form.innerHTML = ''; 

        const gpaResultEl = document.getElementById("gpaResult");
        gpaResultEl.style.display = "none";

        if (!sem) {
            form.innerHTML = `<div class="empty-state"><i class="fas fa-arrow-up"></i><p>Please select a semester to begin.</p></div>`;
            updateArrearsList();
            renderGradeDistributionChart();
            return;
        }
        localStorage.setItem("lastSemester", sem);

        const subjects = academicData.branches[currentBranch].semesters[sem];
        if (!subjects || subjects.length === 0) {
            form.innerHTML = `<div class="empty-state"><i class="fas fa-box-open"></i><p>Subject data for this semester is not available yet.</p></div>`;
            return;
        }

        const grid = document.createElement('div');
        grid.className = 'subject-grid';
        const fragment = document.createDocumentFragment();
        const semesterKey = `${currentBranch}_${sem}`;
        if (!currentGrades[semesterKey]) currentGrades[semesterKey] = Array(subjects.length).fill("");
        
        subjects.forEach((sub, i) => {
            const card = document.createElement('div');
            card.className = 'subject-card stagger-in';
            card.style.animationDelay = `${i * 30}ms`;
            card.innerHTML = `<div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 10px;">
                                <span style="font-weight: 600; font-size: 0.9rem;">${sub.code}</span>
                                <span style="background: rgba(0,0,0,0.4); padding: 4px 10px; border-radius: 20px; font-size: 0.85rem;">${sub.credits} Credits</span>
                              </div>
                              <div style="margin: 12px 0; font-size: 1.05rem; min-height: 40px;">${sub.name}</div>
                              <select data-index="${i}"></select>`;
            
            const select = card.querySelector('select');
            select.innerHTML = '<option value="">-- Grade --</option>' + Object.keys(gradePoints).map(g => `<option value="${g}">${g}</option>`).join('');
            select.value = currentGrades[semesterKey][i] || "";
            fragment.appendChild(card);
        });
        
        grid.appendChild(fragment);
        form.appendChild(grid);
        
        calculateGPA(sem);
        updateAllDisplays();
    }
    
    // --- Calculation & Logic ---
    function handleGradeChange(e) {
        if (e.target.tagName !== 'SELECT') return;
        const sem = document.getElementById("semester").value;
        const index = parseInt(e.target.dataset.index, 10);
        const grade = e.target.value;
        const semesterKey = `${currentBranch}_${sem}`;

        if (!currentGrades[semesterKey]) {
            const subjectCount = academicData.branches[currentBranch].semesters[sem].length;
            currentGrades[semesterKey] = Array(subjectCount).fill("");
        }
        currentGrades[semesterKey][index] = grade;
        localStorage.setItem("currentGrades", JSON.stringify(currentGrades));
        
        calculateGPA(sem);
        debouncedFullUpdate();
    }

    function calculateGPA(sem) {
        const gpaResultEl = document.getElementById("gpaResult");
        const semesterKey = `${currentBranch}_${sem}`;
        const subjects = academicData.branches[currentBranch].semesters[sem];
        const activeGrades = currentGrades[semesterKey] || [];

        if (!subjects || subjects.length === 0) {
            gpaResultEl.style.display = 'none';
            return;
        }

        let totalPoints = 0, totalCredits = 0;
        subjects.forEach((sub, i) => {
            const grade = activeGrades[i];
            if (grade) { totalPoints += gradePoints[grade] * sub.credits; totalCredits += sub.credits; }
        });

        const gpa = totalCredits > 0 ? (totalPoints / totalCredits) : 0;
        
        gpaPerSem[semesterKey] = { gpa: parseFloat(gpa.toFixed(2)), credits: totalCredits };
        localStorage.setItem("gpaPerSem", JSON.stringify(gpaPerSem));

        gpaResultEl.style.display = "block";
        gpaResultEl.innerHTML = `<div class="result-label" style="font-size: 1.2rem;">Semester ${sem} GPA</div>
                                 <div class="result-value" style="font-size: 3rem;">${gpa.toFixed(2)}</div>
                                 <div style="width: 80%; margin: 15px auto 0; height: 10px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                                    <div style="height: 100%; background: linear-gradient(90deg, var(--light), #c9d6ff); border-radius: 5px; transition: width 0.5s ease; width: ${(gpa/10)*100}%"></div>
                                 </div>`;
    }

    function calculateOverallCGPA() {
        let totalWeightedGpa = 0, totalCredits = 0;
        Object.keys(gpaPerSem).filter(k => k.startsWith(currentBranch)).forEach(key => {
            totalWeightedGpa += gpaPerSem[key].gpa * gpaPerSem[key].credits;
            totalCredits += gpaPerSem[key].credits;
        });
        const cgpa = totalCredits > 0 ? (totalWeightedGpa / totalCredits) : 0;
        return { cgpa, totalCredits };
    }

    function updateAllDisplays() {
        const { cgpa, totalCredits } = calculateOverallCGPA();
        const arrears = updateArrearsList();

        document.getElementById('summaryCgpaValue').textContent = cgpa.toFixed(2);
        document.getElementById('summaryCreditsValue').textContent = totalCredits;
        document.getElementById('summaryArrearsValue').textContent = arrears.count;
        
        renderGradeDistributionChart();
        document.title = `${cgpa.toFixed(2)} CGPA | AJ STUDIOS`;
    }

    function updateArrearsList() {
        const arrearsSection = document.getElementById("arrearsSection");
        const arrearsList = document.getElementById("arrearsList");
        arrearsList.innerHTML = '';
        let arrearCount = 0;
        const sem = document.getElementById("semester").value;
        if (!sem) { arrearsSection.style.display = "none"; return { count: 0 };}

        const semesterKey = `${currentBranch}_${sem}`;
        const subjects = academicData.branches[currentBranch].semesters[sem];
        const grades = currentGrades[semesterKey] || [];
        const arrearSubjects = [];

        subjects.forEach((sub, i) => {
            if (grades[i] === 'U') arrearSubjects.push(sub.name);
        });
        
        arrearCount = arrearSubjects.length;
        if (arrearCount > 0) {
            arrearsSection.style.display = "block";
            const fragment = document.createDocumentFragment();
            arrearSubjects.forEach(name => {
                const li = document.createElement('li');
                li.textContent = name;
                fragment.appendChild(li);
            });
            arrearsList.appendChild(fragment);
        } else {
            arrearsSection.style.display = "none";
        }
        return { count: arrearCount };
    }
    
    // --- Charting & Utilities ---
    function initCharts() {
        const commonOptions = { plugins: { legend: { display: false } }, responsive: true, maintainAspectRatio: false };
        if (gradeDistSummaryChart) gradeDistSummaryChart.destroy();
        gradeDistSummaryChart = new Chart(document.getElementById('gradeDistSummaryChart').getContext('2d'), { type: 'pie', data: {}, options: commonOptions });
    }
    function renderGradeDistributionChart() {
        if (!currentBranch || !gradeDistSummaryChart) return;
        const sem = document.getElementById("semester").value;
        const key = `${currentBranch}_${sem}`;
        const grades = currentGrades[key] || [];
        const counts = {};
        grades.filter(g => g).forEach(g => { counts[g] = (counts[g] || 0) + 1; });
        
        gradeDistSummaryChart.data = {
            labels: Object.keys(counts),
            datasets: [{ data: Object.values(counts), backgroundColor: ['#00b09b', '#4ECDC4', '#8BC34A', '#CDDC39', '#FFC107', '#FF9800', '#ff416c'] }]
        };
        gradeDistSummaryChart.update();
    }
    function toggleDarkMode() { document.body.classList.toggle('dark-mode'); localStorage.setItem('darkMode', document.body.classList.contains('dark-mode') ? 'enabled' : 'disabled'); document.getElementById('themeToggle').innerHTML = document.body.classList.contains('dark-mode') ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>'; initCharts(); updateAllDisplays(true); }
    function resetCalculator() { if (confirm("Are you sure? This will clear all saved data.")) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>
